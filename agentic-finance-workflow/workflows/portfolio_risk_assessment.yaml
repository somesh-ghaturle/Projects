workflow_id: "portfolio_risk_assessment"
name: "Portfolio Risk Assessment"
description: "Comprehensive risk assessment workflow for investment portfolios including holdings analysis, correlation analysis, VaR calculation, and optimization recommendations"
version: "1.0"

global_config:
  data_source: "multiple"
  benchmark: "SPY"
  confidence_level: 0.95
  lookback_period: 252  # 1 year
  rebalancing_frequency: "quarterly"
  currency: "USD"

error_handling:
  continue_on_error: false
  max_retries: 2
  retry_delay: 3
  escalate_to_human: true

human_review_required: true

steps:
  - step_id: "portfolio_data_cleaning"
    agent_type: "cleaner"
    agent_config:
      cleaning_rules:
        handle_missing: "forward_fill"
        outlier_method: "zscore"
        outlier_threshold: 4.0
        validate_business_hours: true
        remove_duplicates: true
    input_mapping:
      data: "portfolio_holdings_data"
      data_type: "portfolio_prices"
    output_mapping:
      cleaned_data: "clean_portfolio_data"
      cleaning_report: "portfolio_quality_report"
    depends_on: []
    parallel: false
    retry_on_failure: true
    timeout_seconds: 600

  - step_id: "benchmark_data_cleaning"
    agent_type: "cleaner"
    agent_config:
      cleaning_rules:
        handle_missing: "interpolate"
        outlier_method: "iqr"
        outlier_threshold: 3.0
    input_mapping:
      data: "benchmark_data"
      symbol: "benchmark"
      data_type: "stock_prices"
    output_mapping:
      cleaned_data: "clean_benchmark_data"
    depends_on: []
    parallel: true
    retry_on_failure: true
    timeout_seconds: 300

  - step_id: "portfolio_validation"
    agent_type: "validator"
    agent_config:
      validation_rules:
        weight_validation: true
        price_consistency: true
        currency_consistency: true
        holdings_validation: true
      total_weight_tolerance: 0.01
    input_mapping:
      data: "clean_portfolio_data"
      holdings: "portfolio_weights"
    output_mapping:
      validated_data: "validated_portfolio_data"
      validation_errors: "portfolio_validation_errors"
    depends_on: ["portfolio_data_cleaning"]
    parallel: false
    retry_on_failure: true
    timeout_seconds: 240

  - step_id: "correlation_analysis"
    agent_type: "analyzer"
    agent_config:
      analysis_type: "correlation"
      correlation_methods: ["pearson", "spearman"]
      rolling_window: 60
      significance_level: 0.05
    input_mapping:
      data: "validated_portfolio_data"
      benchmark: "clean_benchmark_data"
    output_mapping:
      correlation_matrix: "asset_correlations"
      rolling_correlations: "dynamic_correlations"
      correlation_clusters: "asset_clusters"
    depends_on: ["portfolio_validation", "benchmark_data_cleaning"]
    parallel: true
    retry_on_failure: true
    timeout_seconds: 300

  - step_id: "var_calculation"
    agent_type: "analyzer"
    agent_config:
      analysis_type: "var"
      var_methods: ["historical", "parametric", "monte_carlo"]
      confidence_levels: [0.95, 0.99]
      holding_period: 1
      simulations: 10000
    input_mapping:
      data: "validated_portfolio_data"
      weights: "portfolio_weights"
      correlations: "asset_correlations"
    output_mapping:
      var_estimates: "portfolio_var"
      cvar_estimates: "portfolio_cvar"
      risk_contributions: "component_var"
    depends_on: ["correlation_analysis"]
    parallel: true
    retry_on_failure: true
    timeout_seconds: 480

  - step_id: "performance_analysis"
    agent_type: "analyzer"
    agent_config:
      analysis_type: "performance"
      metrics:
        - "total_return"
        - "annualized_return"
        - "volatility"
        - "sharpe_ratio"
        - "max_drawdown"
        - "calmar_ratio"
        - "sortino_ratio"
      benchmark_comparison: true
    input_mapping:
      data: "validated_portfolio_data"
      benchmark: "clean_benchmark_data"
      weights: "portfolio_weights"
    output_mapping:
      performance_metrics: "portfolio_performance"
      benchmark_comparison: "relative_performance"
      attribution_analysis: "performance_attribution"
    depends_on: ["correlation_analysis"]
    parallel: true
    retry_on_failure: true
    timeout_seconds: 360

  - step_id: "risk_visualization"
    agent_type: "visualizer"
    agent_config:
      chart_types:
        - "correlation_heatmap"
        - "var_distribution"
        - "risk_contribution"
        - "efficient_frontier"
        - "drawdown_chart"
      output_format: "interactive"
      include_stress_tests: true
    input_mapping:
      correlations: "asset_correlations"
      var_data: "portfolio_var"
      performance_data: "portfolio_performance"
      risk_contributions: "component_var"
    output_mapping:
      risk_charts: "risk_visualization_results"
      dashboard: "risk_dashboard"
      reports: "risk_reports"
    depends_on: ["var_calculation", "performance_analysis"]
    parallel: false
    retry_on_failure: true
    timeout_seconds: 300

  - step_id: "optimization_recommendations"
    agent_type: "recommender"
    agent_config:
      recommendation_type: "portfolio_optimization"
      optimization_objective: "risk_adjusted_return"
      constraints:
        max_weight: 0.15
        min_weight: 0.02
        sector_limits: true
      rebalancing_threshold: 0.05
    input_mapping:
      current_portfolio: "validated_portfolio_data"
      performance_data: "portfolio_performance"
      risk_data: "portfolio_var"
      correlations: "asset_correlations"
    output_mapping:
      optimization_results: "optimal_weights"
      rebalancing_trades: "recommended_trades"
      expected_improvement: "optimization_benefits"
      implementation_plan: "rebalancing_plan"
    depends_on: ["var_calculation", "performance_analysis"]
    parallel: false
    retry_on_failure: true
    timeout_seconds: 420

metadata:
  created_by: "agentic_finance_system"
  created_at: "2025-08-27"
  tags: ["portfolio_management", "risk_assessment", "optimization"]
  category: "risk_management"
  complexity: "advanced"
  estimated_duration: "15-25 minutes"
  requires_market_data: true
  regulatory_compliance: ["Basel_III", "Solvency_II"]
